# ĐỀ BÀI DỰ ÁN: XÂY DỰNG HỆ THỐNG DỊCH VỤ CHATBOT (BOTPRESS SERVICE) ĐỘC LẬP

**Tác giả:** Manus AI  
**Ngày:** 20 tháng 1 năm 2025  
**Dựa trên:** Botpress v12 - https://github.com/botpress/v12.git

---

## Mục lục

1. [Giới thiệu Dự án](#1-giới-thiệu-dự-án)
   1.1. [Bối cảnh và Động lực](#11-bối-cảnh-và-động-lực)
   1.2. [Mục tiêu Dự án](#12-mục-tiêu-dự-án)
   1.3. [Phạm vi Dự án](#13-phạm-vi-dự-án)
2. [Yêu cầu Kỹ thuật và Công nghệ](#2-yêu-cầu-kỹ-thuật-và-công-nghệ)
   2.1. [Yêu cầu Chức năng](#21-yêu-cầu-chức-năng)
   2.2. [Yêu cầu Phi chức năng](#22-yêu-cầu-phi-chức-năng)
   2.3. [Công nghệ Sử dụng](#23-công-nghệ-sử-dụng)
3. [Kiến trúc và Thiết kế Hệ thống](#3-kiến-trúc-và-thiết-kế-hệ-thống)
   3.1. [Tổng quan Kiến trúc](#31-tổng-quan-kiến-trúc)
   3.2. [Thiết kế Backend (Botpress Service)](#32-thiết-kế-backend-botpress-service)
   3.3. [Tích hợp qua API Gateway và liên kết với các Service khác](#33-tích-hợp-qua-api-gateway-và-liên-kết-với-các-service-khác)
4. [Hạ tầng và DevOps](#4-hạ-tầng-và-devops)
   4.1. [Môi trường Phát triển](#41-môi-trường-phát-triển)
   4.2. [CI/CD Pipeline](#42-cicd-pipeline)
   4.3. [Giám sát và Ghi log](#43-giám-sát-và-ghi-log)
5. [Phát triển Backend (Botpress Service)](#5-phát-triển-backend-botpress-service)
   5.1. [Thiết kế Database](#51-thiết-kế-database)
   5.2. [Phát triển API Chatbot](#52-phát-triển-api-chatbot)
   5.3. [Xử lý Natural Language Understanding](#53-xử-lý-natural-language-understanding)
6. [Kiểm thử và Đảm bảo Chất lượng](#6-kiểm-thử-và-đảm-bảo-chất-lượng)
   6.1. [Unit Testing](#61-unit-testing)
   6.2. [Integration Testing](#62-integration-testing)
   6.3. [End-to-End Testing](#63-end-to-end-testing)
7. [Triển khai và Vận hành](#7-triển-khai-và-vận-hành)
   7.1. [Triển khai Production](#71-triển-khai-production)
   7.2. [Mở rộng và Khả năng sẵn sàng cao](#72-mở-rộng-và-khả-năng-sẵn-sàng-cao)
   7.3. [Sao lưu và Phục hồi](#73-sao-lưu-và-phục-hồi)
8. [Quản lý Dự án và Tài liệu hóa](#8-quản-lý-dự-án-và-tài-liệu-hóa)
   8.1. [Quản lý Phiên bản](#81-quản-lý-phiên-bản)
   8.2. [Quản lý Vấn đề](#82-quản-lý-vấn-đề)
   8.3. [Tài liệu Dự án](#83-tài-liệu-dự-án)

---

## 1. Giới thiệu Dự án

### 1.1. Bối cảnh và Động lực

Việc cung cấp hỗ trợ khách hàng thông minh và tự động hóa là yếu tố quan trọng để nâng cao trải nghiệm người dùng. **Botpress Service** đóng vai trò là hệ thống chatbot độc lập, cung cấp giải pháp toàn diện cho việc tương tác tự động với người dùng, hỗ trợ khách hàng, và tích hợp với các dịch vụ trong hệ thống.

Dựa trên nền tảng Botpress v12 - một framework chatbot mã nguồn mở mạnh mẽ <mcreference link="https://github.com/botpress/v12.git" index="0">0</mcreference>, Botpress Service sẽ được tùy chỉnh và tích hợp sâu vào kiến trúc microservice. Hệ thống sẽ hỗ trợ xử lý ngôn ngữ tự nhiên (NLU), quản lý cuộc hội thoại, và kết nối với các dịch vụ thanh toán, và quản lý người dùng thông qua **API Gateway chung**.

### 1.2. Mục tiêu Dự án

Mục tiêu tổng thể là phát triển một dịch vụ chatbot độc lập và hoàn chỉnh mang tên "Botpress Service", cung cấp khả năng tương tác thông minh với người dùng.

* **Xây dựng Chatbot Service mạnh mẽ:** Phát triển một dịch vụ chatbot chuyên biệt, xử lý toàn bộ logic về xử lý ngôn ngữ tự nhiên, quản lý cuộc hội thoại, và tích hợp với các dịch vụ backend.
* **Cung cấp khả năng tương tác đa kênh:** Hỗ trợ tích hợp với nhiều kênh giao tiếp như Webchat, Facebook Messenger, Telegram, WhatsApp, và các nền tảng khác.
* **Tích hợp với các dịch vụ:** Kết nối với dịch vụ thanh toán và hệ thống quản lý người dùng để cung cấp trải nghiệm liền mạch.
* **Xử lý ngôn ngữ tự nhiên thông minh:** Triển khai NLU để hiểu ý định người dùng và cung cấp phản hồi chính xác.
* **Đảm bảo khả năng mở rộng và bảo trì:** Áp dụng các nguyên tắc kiến trúc hiện đại, container hóa, và quy trình DevOps để hệ thống có thể dễ dàng mở rộng và bảo trì.

### 1.3. Phạm vi Dự án

* **Backend Service (Botpress Service):**
  * **Quản lý Chatbot:**
    * API tạo và quản lý bot instances
    * API quản lý cuộc hội thoại (conversations)
    * API xử lý tin nhắn và phản hồi
    * API quản lý flows và actions
    * API tích hợp với các messaging channels
  * **Natural Language Understanding (NLU):**
    * Xử lý và phân tích ý định người dùng (intent recognition)
    * Trích xuất thực thể (entity extraction) từ tin nhắn
    * Hỗ trợ đa ngôn ngữ (tiếng Việt, tiếng Anh)
    * Training và quản lý models NLU
  * **Tích hợp với các dịch vụ:**
    * Tích hợp với Payment Service cho các giao dịch
    * Liên kết với User Service (Authify) để xác thực người dùng
    * Tương tác với Content Service để lấy thông tin hỗ trợ

* **Infrastructure & DevOps:**
  * Container hóa Botpress service bằng Docker
  * Thiết lập môi trường phát triển cục bộ bằng Docker Compose
  * Xây dựng quy trình CI/CD cho việc kiểm thử và triển khai
  * Thiết lập giám sát và ghi log tập trung cho service

**Các tính năng nằm ngoài phạm vi của dự án này:**

* Phát triển custom UI cho Botpress Studio (sử dụng UI có sẵn)
* Tích hợp với các AI services bên thứ ba (OpenAI, Dialogflow)
* Hệ thống analytics và reporting nâng cao
* Voice-to-text và text-to-speech capabilities

---

## 2. Yêu cầu Kỹ thuật và Công nghệ

### 2.1. Yêu cầu Chức năng

Các yêu cầu chức năng mô tả những gì Botpress Service phải làm để đáp ứng mục tiêu của dự án:

* **Quản lý Chatbot và Cuộc hội thoại:**
  * Cung cấp API để tạo, cấu hình và quản lý các bot instances
  * Xử lý tin nhắn đến từ nhiều kênh khác nhau (Webchat, Messenger, Telegram, etc.)
  * Quản lý trạng thái cuộc hội thoại và context của người dùng
  * Hỗ trợ conversation flows phức tạp với điều kiện và branching
  * Cung cấp khả năng fallback và error handling trong cuộc hội thoại

* **Natural Language Understanding (NLU):**
  * Nhận diện ý định người dùng (intent classification) với độ chính xác cao
  * Trích xuất thông tin quan trọng từ tin nhắn (entity extraction)
  * Hỗ trợ xử lý ngôn ngữ tiếng Việt và tiếng Anh
  * Training và cập nhật models NLU dựa trên dữ liệu mới
  * Xử lý các câu hỏi thông thường và trích xuất thông tin cần thiết

* **Tích hợp với các dịch vụ:**
  * **Xử lý thanh toán:** Tích hợp với Payment Service để xử lý các giao dịch premium
  * **Xác thực người dùng:** Liên kết với Authify Service để xác thực và quản lý phiên người dùng
  * **Lấy nội dung hỗ trợ:** Kết nối với Content Service để cung cấp hướng dẫn và tài liệu

* **Multi-channel Support:**
  * Hỗ trợ Webchat widget tích hợp vào website
  * Tích hợp với Facebook Messenger
  * Hỗ trợ Telegram Bot
  * Khả năng mở rộng cho WhatsApp Business API
  * REST API cho tích hợp custom channels

* **Administration và Monitoring:**
  * Dashboard để giám sát hoạt động của chatbot
  * Logs và analytics về cuộc hội thoại
  * Quản lý cấu hình bot và NLU models
  * Export/Import bot configurations

### 2.2. Yêu cầu Phi chức năng

Các yêu cầu phi chức năng mô tả cách Botpress Service hoạt động:

* **Hiệu suất:**
  * Thời gian phản hồi tin nhắn dưới 200ms
  * Khả năng xử lý đồng thời tối thiểu 1000 cuộc hội thoại
  * NLU processing time dưới 100ms cho mỗi tin nhắn
  * Hỗ trợ horizontal scaling khi tải tăng cao

* **Độ tin cậy:**
  * Uptime tối thiểu 99.5%
  * Khả năng phục hồi tự động khi gặp lỗi
  * Backup và restore conversations và configurations
  * Graceful degradation khi các service phụ thuộc không khả dụng

* **Bảo mật:**
  * Mã hóa tất cả communications qua HTTPS/WSS
  * Xác thực và phân quyền cho admin APIs
  * Bảo vệ chống lại injection attacks và XSS
  * Rate limiting cho các endpoints công khai
  * Secure storage cho conversation data và user information

* **Khả năng mở rộng:**
  * Kiến trúc microservice cho phép scale từng component độc lập
  * Hỗ trợ load balancing và clustering
  * Database sharding cho large-scale deployments
  * Plugin architecture cho custom extensions

* **Khả năng tương thích:**
  * RESTful APIs tuân thủ OpenAPI specification
  * WebSocket support cho real-time communication
  * Tương thích với Botpress v12 ecosystem
  * Cross-platform deployment (Linux, Windows, macOS)

### 2.3. Công nghệ Sử dụng

Để xây dựng Botpress Service, các công nghệ sau đây được sử dụng:

* **Core Platform:**
  * **Botpress v12:** Framework chatbot chính <mcreference link="https://github.com/botpress/v12.git" index="0">0</mcreference>
  * **Node.js 12+:** Runtime environment
  * **TypeScript:** Ngôn ngữ lập trình chính
  * **Express.js:** Web framework cho REST APIs

* **Natural Language Understanding:**
  * **Botpress NLU:** Built-in NLU engine
  * **Duckling:** Entity extraction (Facebook's Duckling)
  * **Language Models:** Hỗ trợ tiếng Việt và tiếng Anh

* **Database:**
  * **PostgreSQL:** Primary database cho conversations và configurations
  * **Redis:** Caching và session storage
  * **SQLite:** Development và testing environment

* **Messaging & Communication:**
  * **WebSocket:** Real-time communication
  * **HTTP/HTTPS:** REST API communication
  * **Message Queues:** Redis Pub/Sub hoặc RabbitMQ

* **DevOps & Infrastructure:**
  * **Docker:** Containerization
  * **Docker Compose:** Local development environment
  * **Kubernetes:** Production orchestration (optional)
  * **GitHub Actions:** CI/CD pipeline
  * **Prometheus + Grafana:** Monitoring và metrics
  * **ELK Stack:** Centralized logging

* **Development Tools:**
  * **ESLint + Prettier:** Code formatting và linting
  * **Jest:** Unit testing framework
  * **Supertest:** API testing
  * **Botpress Studio:** Visual conversation designer

---

## 3. Kiến trúc và Thiết kế Hệ thống

### 3.1. Tổng quan Kiến trúc

Botpress Service được thiết kế như một microservice độc lập trong hệ sinh thái MathService, chuyên biệt trong việc xử lý tương tác chatbot và natural language understanding. Service này tương tác với các thành phần khác thông qua **API Gateway chung**, đảm bảo tính bảo mật và khả năng mở rộng.

Kiến trúc của Botpress Service bao gồm các thành phần chính:

1. **Botpress Core Engine:** Xử lý logic chatbot chính
2. **NLU Module:** Xử lý ngôn ngữ tự nhiên
3. **Channel Connectors:** Tích hợp với các messaging platforms
4. **Action Handlers:** Xử lý các actions tùy chỉnh
5. **Database Layer:** Lưu trữ conversations và configurations
6. **API Layer:** Cung cấp REST APIs cho tích hợp

### 3.2. Thiết kế Backend (Botpress Service)

Botpress Service được xây dựng dựa trên kiến trúc modular của Botpress v12, với các customizations để tích hợp với MathService ecosystem:

**Core Components:**

* **Bot Runtime:** Xử lý conversation flows và state management
* **NLU Engine:** Intent classification và entity extraction
* **Action Server:** Xử lý custom actions và API calls
* **Channel Manager:** Quản lý connections đến các messaging platforms
* **Configuration Manager:** Quản lý bot configurations và settings

**Custom Modules:**

* **Payment Integration Module:** Kết nối với Payment Service
* **User Authentication Module:** Tích hợp với Authify Service
* **Content Retrieval Module:** Lấy thông tin từ Content Service

### 3.3. Tích hợp qua API Gateway và liên kết với các Service khác

Botpress Service tương tác với các microservice khác thông qua API Gateway chung:

**Outbound Integrations (Botpress → Other Services):**

* **Authify Service:** Xác thực người dùng và lấy thông tin profile
* **Payment Service:** Xử lý thanh toán cho premium features
* **Content Service:** Lấy nội dung hỗ trợ và documentation

**Inbound APIs (Other Services → Botpress):**

* **Webhook APIs:** Nhận tin nhắn từ messaging platforms
* **Management APIs:** Quản lý bot configurations
* **Analytics APIs:** Lấy thống kê và metrics
* **Health Check APIs:** Monitoring và health status

---

## 4. Hạ tầng và DevOps

### 4.1. Môi trường Phát triển

**Local Development Setup:**

```yaml
# docker-compose.yml cho development
version: '3.8'
services:
  botpress:
    build: .
    ports:
      - "3000:3000"
    environment:
      - DATABASE_URL=postgres://user:pass@postgres:5432/botpress
      - REDIS_URL=redis://redis:6379
    volumes:
      - ./data:/botpress/data
    depends_on:
      - postgres
      - redis

  postgres:
    image: postgres:13
    environment:
      POSTGRES_DB: botpress
      POSTGRES_USER: user
      POSTGRES_PASSWORD: pass
    volumes:
      - postgres_data:/var/lib/postgresql/data

  redis:
    image: redis:6-alpine
    volumes:
      - redis_data:/data

volumes:
  postgres_data:
  redis_data:
```

### 4.2. CI/CD Pipeline

**GitHub Actions Workflow:**

```yaml
name: Botpress Service CI/CD

on:
  push:
    branches: [main, develop]
  pull_request:
    branches: [main]

jobs:
  test:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v2
      - uses: actions/setup-node@v2
        with:
          node-version: '16'
      - run: npm ci
      - run: npm run lint
      - run: npm run test
      - run: npm run build

  build-and-push:
    needs: test
    runs-on: ubuntu-latest
    if: github.ref == 'refs/heads/main'
    steps:
      - uses: actions/checkout@v2
      - name: Build and push Docker image
        uses: docker/build-push-action@v2
        with:
          push: true
          tags: mathservice/botpress:latest
```

### 4.3. Giám sát và Ghi log

**Monitoring Stack:**

* **Prometheus:** Thu thập metrics từ Botpress service
* **Grafana:** Visualization và alerting
* **ELK Stack:** Centralized logging
* **Health Checks:** Endpoint monitoring

**Key Metrics:**

* Message processing rate
* Response time
* NLU accuracy
* Active conversations
* Error rates
* Resource utilization

---

## 5. Phát triển Backend (Botpress Service)

### 5.1. Thiết kế Database

**PostgreSQL Schema cho Botpress:**

```sql
-- Conversations table
CREATE TABLE conversations (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    bot_id VARCHAR(255) NOT NULL,
    user_id VARCHAR(255) NOT NULL,
    channel VARCHAR(100) NOT NULL,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    metadata JSONB
);

-- Messages table
CREATE TABLE messages (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    conversation_id UUID REFERENCES conversations(id),
    direction VARCHAR(20) NOT NULL, -- 'incoming' or 'outgoing'
    content JSONB NOT NULL,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    processed BOOLEAN DEFAULT FALSE
);

-- Bot configurations
CREATE TABLE bot_configs (
    bot_id VARCHAR(255) PRIMARY KEY,
    config JSONB NOT NULL,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

-- NLU training data
CREATE TABLE nlu_training_data (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    bot_id VARCHAR(255) NOT NULL,
    intent VARCHAR(255) NOT NULL,
    utterance TEXT NOT NULL,
    entities JSONB,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);
```

### 5.2. Phát triển API Chatbot

**Core API Endpoints:**

```typescript
// Message processing endpoint
POST /api/v1/bots/{botId}/converse
{
  "type": "text",
  "text": "Xin chào, tôi cần hỗ trợ",
  "userId": "user123",
  "channel": "webchat"
}

// Bot management endpoints
GET /api/v1/bots
POST /api/v1/bots
GET /api/v1/bots/{botId}
PUT /api/v1/bots/{botId}
DELETE /api/v1/bots/{botId}

// Conversation management
GET /api/v1/conversations
GET /api/v1/conversations/{conversationId}
DELETE /api/v1/conversations/{conversationId}

// Analytics endpoints
GET /api/v1/analytics/conversations
GET /api/v1/analytics/intents
GET /api/v1/analytics/performance
```

### 5.3. Xử lý Natural Language Understanding

**NLU Configuration:**

```yaml
# NLU intents cho general support
intents:
  - name: greeting
    utterances:
      - "Xin chào"
      - "Hello"
      - "Hi there"
    entities: []

  - name: get_help
    utterances:
      - "Hướng dẫn sử dụng"
      - "Help me"
      - "Làm thế nào để"
    entities: []

  - name: payment_inquiry
    utterances:
      - "Thanh toán như thế nào"
      - "Giá cả ra sao"
      - "How much does it cost"
    entities: []

  - name: goodbye
    utterances:
      - "Tạm biệt"
      - "Goodbye"
      - "See you later"
    entities: []

entities:
  - name: user_name
    type: pattern
    patterns:
      - "[A-Za-z\s]+"
```

**Custom Actions:**

```typescript
// Action: Greeting
export const greetingAction = async (bp: typeof sdk, event: sdk.IO.IncomingEvent) => {
  const userId = event.target
  
  try {
    // Get user info from Authify
    const userInfo = await bp.http.get(`/api/auth/users/${userId}`)
    
    await bp.events.replyToEvent(event, {
      type: 'text',
      text: `Xin chào ${userInfo.data.name || 'bạn'}! Tôi có thể giúp gì cho bạn hôm nay?`
    })
  } catch (error) {
    await bp.events.replyToEvent(event, {
      type: 'text',
      text: 'Xin chào! Tôi có thể giúp gì cho bạn hôm nay?'
    })
  }
}

// Action: Process Payment
export const processPaymentAction = async (bp: typeof sdk, event: sdk.IO.IncomingEvent) => {
  const userId = event.target
  
  try {
    // Get user info from Authify
    const userInfo = await bp.http.get(`/api/auth/users/${userId}`)
    
    // Create payment session
    const paymentSession = await bp.http.post('/api/payment/create-session', {
      userId: userId,
      amount: 10000, // VND
      description: 'Premium Service'
    })
    
    await bp.events.replyToEvent(event, {
      type: 'card',
      title: 'Thanh toán dịch vụ Premium',
      subtitle: 'Truy cập không giới hạn các tính năng premium',
      actions: [{
        type: 'postback',
        title: 'Thanh toán ngay',
        payload: `PAYMENT_${paymentSession.data.sessionId}`
      }]
    })
  } catch (error) {
    await bp.events.replyToEvent(event, {
      type: 'text',
      text: 'Có lỗi xảy ra khi xử lý thanh toán. Vui lòng thử lại sau.'
    })
  }
}
```

---

## 6. Kiểm thử và Đảm bảo Chất lượng

### 6.1. Unit Testing

**Testing Framework:** Jest + Supertest

```typescript
// Test NLU processing
describe('NLU Processing', () => {
  test('should recognize greeting intent', async () => {
    const result = await nlu.process('Xin chào')
    
    expect(result.intent.name).toBe('greeting')
    expect(result.confidence).toBeGreaterThan(0.8)
  })
  
  test('should recognize help intent', async () => {
    const result = await nlu.process('Tôi cần hỗ trợ')
    
    expect(result.intent.name).toBe('get_help')
    expect(result.confidence).toBeGreaterThan(0.7)
  })
})

// Test API endpoints
describe('Chatbot API', () => {
  test('POST /api/v1/bots/{botId}/converse', async () => {
    const response = await request(app)
      .post('/api/v1/bots/test-bot/converse')
      .send({
        type: 'text',
        text: 'Hello',
        userId: 'test-user',
        channel: 'webchat'
      })
    
    expect(response.status).toBe(200)
    expect(response.body).toHaveProperty('responses')
  })
})
```

### 6.2. Integration Testing

**Testing Integration với các dịch vụ:**

```typescript
describe('Service Integration', () => {
  test('should process payment via API', async () => {
    // Mock API Gateway response
    nock('http://api-gateway:8080')
      .post('/api/payment/create-session')
      .reply(200, {
        sessionId: 'session_123',
        paymentUrl: 'https://payment.example.com/session_123'
      })
    
    const event = createMockEvent({
      text: 'Tôi muốn thanh toán',
      nlu: {
        intent: { name: 'payment_inquiry' },
        entities: []
      }
    })
    
    await processPaymentAction(bp, event)
    
    expect(bp.events.replyToEvent).toHaveBeenCalledWith(
      event,
      expect.objectContaining({
        type: 'card',
        title: expect.stringContaining('Thanh toán')
      })
    )
  })
})
```

### 6.3. End-to-End Testing

**E2E Testing với Puppeteer:**

```typescript
describe('Chatbot E2E Tests', () => {
  test('complete conversation flow', async () => {
    const page = await browser.newPage()
    await page.goto('http://localhost:3000/webchat')
    
    // Send message
    await page.type('#message-input', 'Xin chào')
    await page.click('#send-button')
    
    // Wait for response
    await page.waitForSelector('.bot-message', { timeout: 5000 })
    
    const response = await page.$eval('.bot-message', el => el.textContent)
    expect(response).toContain('Xin chào')
  })
})
```

---

## 7. Triển khai và Vận hành

### 7.1. Triển khai Production

**Docker Configuration:**

```dockerfile
# Dockerfile
FROM node:16-alpine

WORKDIR /botpress

# Copy package files
COPY package*.json ./
RUN npm ci --only=production

# Copy source code
COPY . .

# Build application
RUN npm run build

# Expose port
EXPOSE 3000

# Health check
HEALTHCHECK --interval=30s --timeout=3s --start-period=5s --retries=3 \
  CMD curl -f http://localhost:3000/health || exit 1

# Start application
CMD ["npm", "start"]
```

**Production Docker Compose:**

```yaml
version: '3.8'
services:
  botpress:
    image: mathservice/botpress:latest
    ports:
      - "3000:3000"
    environment:
      - NODE_ENV=production
      - DATABASE_URL=${DATABASE_URL}
      - REDIS_URL=${REDIS_URL}
      - API_GATEWAY_URL=${API_GATEWAY_URL}
    restart: unless-stopped
    depends_on:
      - postgres
      - redis
    networks:
      - mathservice-network

  postgres:
    image: postgres:13
    environment:
      POSTGRES_DB: ${POSTGRES_DB}
      POSTGRES_USER: ${POSTGRES_USER}
      POSTGRES_PASSWORD: ${POSTGRES_PASSWORD}
    volumes:
      - postgres_data:/var/lib/postgresql/data
    restart: unless-stopped
    networks:
      - mathservice-network

  redis:
    image: redis:6-alpine
    volumes:
      - redis_data:/data
    restart: unless-stopped
    networks:
      - mathservice-network

volumes:
  postgres_data:
  redis_data:

networks:
  mathservice-network:
    external: true
```

### 7.2. Mở rộng và Khả năng sẵn sàng cao

**Horizontal Scaling:**

* Load balancer (Nginx/HAProxy) phân phối traffic
* Multiple Botpress instances với shared Redis session store
* Database connection pooling và read replicas
* CDN cho static assets

**High Availability:**

* Multi-zone deployment
* Database clustering với failover
* Redis Sentinel cho high availability caching
* Health checks và automatic restart

### 7.3. Sao lưu và Phục hồi

**Backup Strategy:**

```bash
#!/bin/bash
# Backup script

# Database backup
pg_dump $DATABASE_URL > /backups/botpress_$(date +%Y%m%d_%H%M%S).sql

# Bot configurations backup
tar -czf /backups/bot_configs_$(date +%Y%m%d_%H%M%S).tar.gz /botpress/data/bots

# Upload to cloud storage
aws s3 cp /backups/ s3://mathservice-backups/botpress/ --recursive
```

**Recovery Procedures:**

1. Database restoration từ backup
2. Bot configuration restoration
3. NLU model retraining nếu cần thiết
4. Service health verification

---

## 8. Quản lý Dự án và Tài liệu hóa

### 8.1. Quản lý Phiên bản

**Semantic Versioning:**

* **Major (X.0.0):** Breaking changes, major feature additions
* **Minor (0.X.0):** New features, backward compatible
* **Patch (0.0.X):** Bug fixes, security patches

**Release Process:**

1. Feature development trong feature branches
2. Code review và testing
3. Merge vào develop branch
4. Integration testing
5. Release candidate creation
6. Production deployment
7. Tag và release notes

### 8.2. Quản lý Vấn đề

**Issue Categories:**

* **Bug:** Lỗi trong functionality
* **Feature:** Yêu cầu tính năng mới
* **Enhancement:** Cải thiện tính năng hiện có
* **Documentation:** Cập nhật tài liệu
* **Security:** Vấn đề bảo mật

**Priority Levels:**

* **Critical:** Ảnh hưởng nghiêm trọng đến service
* **High:** Ảnh hưởng đáng kể đến user experience
* **Medium:** Cải thiện chất lượng
* **Low:** Nice-to-have features

### 8.3. Tài liệu Dự án

**Documentation Structure:**

```
docs/
├── api/
│   ├── chatbot-api.md
│   ├── admin-api.md
│   └── webhook-api.md
├── deployment/
│   ├── docker-setup.md
│   ├── production-deployment.md
│   └── scaling-guide.md
├── development/
│   ├── setup-guide.md
│   ├── coding-standards.md
│   └── testing-guide.md
├── integration/
│   ├── mathservice-integration.md
│   ├── channel-setup.md
│   └── nlu-training.md
└── troubleshooting/
    ├── common-issues.md
    ├── performance-tuning.md
    └── monitoring-guide.md
```

**API Documentation:**

Sử dụng OpenAPI/Swagger để tự động generate API documentation:

```yaml
openapi: 3.0.0
info:
  title: Botpress Service API
  version: 1.0.0
  description: API documentation for MathService Botpress integration

paths:
  /api/v1/bots/{botId}/converse:
    post:
      summary: Process user message
      parameters:
        - name: botId
          in: path
          required: true
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                type:
                  type: string
                  enum: [text, postback, quick_reply]
                text:
                  type: string
                userId:
                  type: string
                channel:
                  type: string
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                type: object
                properties:
                  responses:
                    type: array
                    items:
                      type: object
```

---

## Kết luận

Botpress Service là một thành phần quan trọng, cung cấp khả năng tương tác thông minh và tự động hóa hỗ trợ khách hàng. Với việc tích hợp sâu vào kiến trúc microservice và sử dụng nền tảng Botpress v12 mạnh mẽ, service này sẽ mang lại trải nghiệm người dùng xuất sắc và hỗ trợ hiệu quả.

Việc triển khai theo các nguyên tắc DevOps hiện đại, kết hợp với monitoring và testing toàn diện, đảm bảo rằng Botpress Service sẽ hoạt động ổn định, có khả năng mở rộng và dễ dàng bảo trì trong môi trường production.

**Các bước tiếp theo:**

1. Setup môi trường development
2. Implement core chatbot functionality
3. Develop NLU models cho tiếng Việt
4. Tích hợp với các Service APIs
5. Testing và optimization
6. Production deployment
7. Monitoring và continuous improvement

---

**Tài liệu tham khảo:**

- Botpress v12 Documentation: https://v12.botpress.com/
- Botpress GitHub Repository: https://github.com/botpress/v12
- Microservice Architecture Documentation
- API Gateway Integration Guide