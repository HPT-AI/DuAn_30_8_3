# Kong Configuration File
# This file contains Kong Gateway configuration settings

# Basic settings
prefix = /usr/local/kong/
log_level = info
proxy_access_log = /dev/stdout
proxy_error_log = /dev/stderr
admin_access_log = /dev/stdout
admin_error_log = /dev/stderr

# Database settings (using PostgreSQL)
database = postgres
pg_host = kong-database
pg_port = 5432
pg_timeout = 5000
pg_user = kong
pg_password = kongpass
pg_database = kong

# Network settings
proxy_listen = 0.0.0.0:8000, 0.0.0.0:8443 ssl
admin_listen = 0.0.0.0:8001, 0.0.0.0:8444 ssl

# SSL settings
ssl_cert = /etc/kong/ssl/kong.crt
ssl_cert_key = /etc/kong/ssl/kong.key
admin_ssl_cert = /etc/kong/ssl/admin.crt
admin_ssl_cert_key = /etc/kong/ssl/admin.key

# Performance settings
nginx_worker_processes = auto
nginx_daemon = off
mem_cache_size = 128m
upstream_keepalive_pool_size = 60
upstream_keepalive_max_requests = 100
upstream_keepalive_idle_timeout = 60s

# Security settings
trusted_ips = 0.0.0.0/0,::/0
real_ip_header = X-Real-IP
real_ip_recursive = off

# Plugin settings
plugins = bundled,jwt,cors,rate-limiting,file-log,prometheus,request-transformer,response-transformer

# Declarative configuration
declarative_config = /etc/kong/kong.yml
declarative_config_string = ""

# Clustering (for multi-node setup)
cluster_listen = 0.0.0.0:8005
cluster_control_plane = 127.0.0.1:8005

# Status API
status_listen = 0.0.0.0:8100

# Health checks
health_checks_threshold = 60

# DNS settings
dns_resolver = 8.8.8.8,8.8.4.4
dns_hostsfile = /etc/hosts
dns_order = LAST,SRV,A,CNAME
dns_valid_ttl = 10
dns_stale_ttl = 4
dns_not_found_ttl = 30
dns_error_ttl = 1
dns_no_sync = off

# Timeouts
upstream_keepalive_timeout = 60s
client_max_body_size = 0
client_body_buffer_size = 8k